const ENG_BASE = [
  "`",
  "1",
  "2",
  "3",
  "4",
  "5",
  "6",
  "7",
  "8",
  "9",
  "0",
  "-",
  "=",
  "Backspace",
  "Tab",
  "q",
  "w",
  "e",
  "r",
  "t",
  "y",
  "u",
  "i",
  "o",
  "p",
  "[",
  "]",
  "\\",
  "Del",
  "Caps Lock",
  "a",
  "s",
  "d",
  "f",
  "g",
  "h",
  "j",
  "k",
  "l",
  ";",
  "'",
  "Enter",
  "Shift",
  "z",
  "x",
  "c",
  "v",
  "b",
  "n",
  "m",
  ",",
  ".",
  "/",
  "&uarr;",
  "Shift",
  "Ctrl",
  "Win",
  "Alt",
  "Space",
  "Alt",
  "&larr;",
  "&darr;",
  "&rarr;",
  "Ctrl",
];

const ENG_CAPS = [
  "`",
  "1",
  "2",
  "3",
  "4",
  "5",
  "6",
  "7",
  "8",
  "9",
  "0",
  "-",
  "=",
  "Backspace",
  "Tab",
  "Q",
  "W",
  "E",
  "R",
  "T",
  "Y",
  "U",
  "I",
  "O",
  "P",
  "{",
  "}",
  "|",
  "Del",
  "Caps Lock",
  "A",
  "S",
  "D",
  "F",
  "G",
  "H",
  "J",
  "K",
  "L",
  ":",
  '"',
  "Enter",
  "Shift",
  "Z",
  "X",
  "C",
  "V",
  "B",
  "N",
  "M",
  "<",
  ">",
  "?",
  "&uarr;",
  "Shift",
  "Ctrl",
  "Win",
  "Alt",
  "Space",
  "Alt",
  "&larr;",
  "&darr;",
  "&rarr;",
  "Ctrl",
];

const ENG_SHIFT = [
  "~",
  "!",
  "@",
  "#",
  "$",
  "%",
  "^",
  "&",
  "*",
  "(",
  ")",
  "_",
  "+",
  "Backspace",
  "Tab",
  "Q",
  "W",
  "E",
  "R",
  "T",
  "Y",
  "U",
  "I",
  "O",
  "P",
  "{",
  "}",
  "|",
  "Del",
  "Caps Lock",
  "A",
  "S",
  "D",
  "F",
  "G",
  "H",
  "J",
  "K",
  "L",
  ":",
  '"',
  "Enter",
  "Shift",
  "Z",
  "X",
  "C",
  "V",
  "B",
  "N",
  "M",
  "<",
  ">",
  "?",
  "&uarr;",
  "Shift",
  "Ctrl",
  "Win",
  "Alt",
  "Space",
  "Alt",
  "&larr;",
  "&darr;",
  "&rarr;",
  "Ctrl",
];

const ENG_CAPS_SHIFT = [
  "~",
  "!",
  "@",
  "#",
  "$",
  "%",
  "^",
  "&",
  "*",
  "(",
  ")",
  "_",
  "+",
  "Backspace",
  "Tab",
  "q",
  "w",
  "e",
  "r",
  "t",
  "y",
  "u",
  "i",
  "o",
  "p",
  "[",
  "]",
  "\\",
  "Del",
  "Caps Lock",
  "a",
  "s",
  "d",
  "f",
  "g",
  "h",
  "j",
  "k",
  "l",
  ";",
  "'",
  "Enter",
  "Shift",
  "z",
  "x",
  "c",
  "v",
  "b",
  "n",
  "m",
  ",",
  ".",
  "/",
  "&uarr;",
  "Shift",
  "Ctrl",
  "Win",
  "Alt",
  "Space",
  "Alt",
  "&larr;",
  "&darr;",
  "&rarr;",
  "Ctrl",
];

const RUS_BASE = [
  "ё",
  "1",
  "2",
  "3",
  "4",
  "5",
  "6",
  "7",
  "8",
  "9",
  "0",
  "-",
  "=",
  "Backspace",
  "Tab",
  "й",
  "ц",
  "у",
  "к",
  "е",
  "н",
  "г",
  "ш",
  "щ",
  "з",
  "х",
  "ъ",
  "\\",
  "Del",
  "Caps Lock",
  "ф",
  "ы",
  "в",
  "а",
  "п",
  "р",
  "о",
  "л",
  "д",
  "ж",
  "э",
  "Enter",
  "Shift",
  "я",
  "ч",
  "с",
  "м",
  "и",
  "т",
  "ь",
  "б",
  "ю",
  "/",
  "&uarr;",
  "Shift",
  "Ctrl",
  "Win",
  "Alt",
  "Space",
  "Alt",
  "&larr;",
  "&darr;",
  "&rarr;",
  "Ctrl",
];

const RUS_CAPS = [
  "Ё",
  "1",
  "2",
  "3",
  "4",
  "5",
  "6",
  "7",
  "8",
  "9",
  "0",
  "-",
  "=",
  "Backspace",
  "Tab",
  "Й",
  "Ц",
  "У",
  "К",
  "Е",
  "Н",
  "Г",
  "Ш",
  "Щ",
  "З",
  "Х",
  "Ъ",
  "/",
  "Del",
  "Caps Lock",
  "Ф",
  "Ы",
  "В",
  "А",
  "П",
  "Р",
  "О",
  "Л",
  "Д",
  "Ж",
  "Э",
  "Enter",
  "Shift",
  "Я",
  "Ч",
  "С",
  "М",
  "И",
  "Т",
  "Ь",
  "Б",
  "Ю",
  "/",
  "&uarr;",
  "Shift",
  "Ctrl",
  "Win",
  "Alt",
  "Space",
  "Alt",
  "&larr;",
  "&darr;",
  "&rarr;",
  "Ctrl",
];

const RUS_SHIFT = [
  "Ё",
  "!",
  '"',
  "№",
  ";",
  "%",
  ":",
  "?",
  "*",
  "(",
  ")",
  "_",
  "+",
  "Backspace",
  "Tab",
  "Й",
  "Ц",
  "У",
  "К",
  "Е",
  "Н",
  "Г",
  "Ш",
  "Щ",
  "З",
  "Х",
  "Ъ",
  "/",
  "Del",
  "Caps Lock",
  "Ф",
  "Ы",
  "В",
  "А",
  "П",
  "Р",
  "О",
  "Л",
  "Д",
  "Ж",
  "Э",
  "Enter",
  "Shift",
  "Я",
  "Ч",
  "С",
  "М",
  "И",
  "Т",
  "Ь",
  "Б",
  "Ю",
  "/",
  "&uarr;",
  "Shift",
  "Ctrl",
  "Win",
  "Alt",
  "Space",
  "Alt",
  "&larr;",
  "&darr;",
  "&rarr;",
  "Ctrl",
];

const RUS_CAPS_SHIFT = [
  "ё",
  "!",
  "@",
  "#",
  "$",
  "%",
  "^",
  "&",
  "*",
  "(",
  ")",
  "_",
  "+",
  "Backspace",
  "Tab",
  "й",
  "ц",
  "у",
  "к",
  "е",
  "н",
  "г",
  "ш",
  "щ",
  "з",
  "х",
  "ъ",
  "\\",
  "Del",
  "Caps Lock",
  "ф",
  "ы",
  "в",
  "а",
  "п",
  "р",
  "о",
  "л",
  "д",
  "ж",
  "э",
  "Enter",
  "Shift",
  "я",
  "ч",
  "с",
  "м",
  "и",
  "т",
  "ь",
  "б",
  "ю",
  "/",
  "&uarr;",
  "Shift",
  "Ctrl",
  "Win",
  "Alt",
  "Space",
  "Alt",
  "&larr;",
  "&darr;",
  "&rarr;",
  "Ctrl",
];

const KEY_CLASS = [
  "Backquote",
  "Digit1",
  "Digit2",
  "Digit3",
  "Digit4",
  "Digit5",
  "Digit6",
  "Digit7",
  "Digit8",
  "Digit9",
  "Digit0",
  "Minus",
  "Equal",
  "Backspace",
  "Tab",
  "KeyQ",
  "KeyW",
  "KeyE",
  "KeyR",
  "KeyT",
  "KeyY",
  "KeyU",
  "KeyI",
  "KeyO",
  "KeyP",
  "BracketLeft",
  "BracketRight",
  "Backslash",
  "Delete",
  "CapsLock",
  "KeyA",
  "KeyS",
  "KeyD",
  "KeyF",
  "KeyG",
  "KeyH",
  "KeyJ",
  "KeyK",
  "KeyL",
  "Semicolon",
  "Quote",
  "Enter",
  "ShiftLeft",
  "KeyZ",
  "KeyX",
  "KeyC",
  "KeyV",
  "KeyB",
  "KeyN",
  "KeyM",
  "Comma",
  "Period",
  "Slash",
  "ArrowUp",
  "ShiftRight",
  "ControlLeft",
  "MetaLeft",
  "AltLeft",
  "Space",
  "AltRight",
  "ArrowLeft",
  "ArrowDown",
  "ArrowRight",
  "ControlRight",
];

const CURRENT_LAYOUT = {
  capsOn: false,
  language: localStorage.getItem("current_language")
    ? localStorage.getItem("current_language")
    : "ENG",
  state: "caseDown",
};

function changeLanguage() {
  let language = CURRENT_LAYOUT.language;
  let keys = document.querySelectorAll(".key");
  if (language === "ENG") {
    keys.forEach((key) => {
      key.querySelector(".eng").classList.add("hidden");
      key.querySelector(".rus").classList.remove("hidden");
    });
    CURRENT_LAYOUT.language = "RUS";
    localStorage.setItem("current_language", CURRENT_LAYOUT.language);
  } else {
    keys.forEach((key) => {
      key.querySelector(".rus").classList.add("hidden");
      key.querySelector(".eng").classList.remove("hidden");
    });
    CURRENT_LAYOUT.language = "ENG";
    localStorage.setItem("current_language", CURRENT_LAYOUT.language);
  }
}

function showCurrentClicked(event) {
  event.classList.add("active");
}

function hideCurrentClicked(event) {
  event.classList.remove("active");
}

function showKeyboard() {
  const BODY = document.querySelector("body");
  BODY.classList.add("body");
  const CENTRALIZER = document.createElement("div");
  CENTRALIZER.classList.add("centralizer");
  BODY.appendChild(CENTRALIZER);
  const TITLE = document.createElement("h1");
  TITLE.innerHTML = "virtual keyboard";
  TITLE.classList.add("title");
  CENTRALIZER.appendChild(TITLE);
  const TEXT_INPUT = document.createElement("textarea");
  TEXT_INPUT.classList.add("textarea");
  CENTRALIZER.appendChild(TEXT_INPUT);
  const KEYBOARD = document.createElement("div");
  KEYBOARD.classList.add("keyboard");
  CENTRALIZER.appendChild(KEYBOARD);

  for (let i = 0; i < KEY_CLASS.length; i += 1) {
    const KEY = `
      <div class="key ${KEY_CLASS[i]}">
        <span class="rus hidden">
          <span class="classChanger caseDown hidden">${RUS_BASE[i]}</span>
          <span class="classChanger caseUp hidden">${RUS_SHIFT[i]}</span>
          <span class="classChanger caps hidden">${RUS_CAPS[i]}</span>
          <span class="classChanger shiftCaps hidden">${RUS_CAPS_SHIFT[i]}</span>
        </span>
        <span class="eng">
          <span class="classChanger caseDown">${ENG_BASE[i]}</span>
          <span class="classChanger caseUp hidden">${ENG_SHIFT[i]}</span>
          <span class="classChanger caps hidden">${ENG_CAPS[i]}</span>
          <span class="classChanger shiftCaps hidden">${ENG_CAPS_SHIFT[i]}</span>
        </span>
      </div>`;
    KEYBOARD.insertAdjacentHTML("beforeend", KEY);
  }

  const ABOUT = document.createElement("div");
  ABOUT.classList.add("description");
  CENTRALIZER.appendChild(ABOUT);
  ABOUT.innerHTML = "Для переключения языка комбинация: левыe ctrl + alt";
}

function changeLayout(targetclass) {
  CURRENT_LAYOUT.state = targetclass;
  const ARRAY_OF_KEYS = document.querySelectorAll(".classChanger");
  ARRAY_OF_KEYS.forEach((span) => {
    if (span.classList.contains(targetclass)) {
      span.classList.remove("hidden");
    } else {
      span.classList.add("hidden");
    }
  });
}

function onMouseDown(event) {
  event.preventDefault();
  const CURR_TARGET = event.target;
  const CURRENT_KEY = event.target.closest(".key").classList[1];
  showCurrentClicked(event.target.closest(".key"));
  console.log(CURRENT_KEY);
  const ALT_KEY = document.querySelector(".AltLeft");
  const CTRL_KEY = document.querySelector(".ControlLeft");
  if (
    (CURRENT_KEY === "ShiftRight" || CURRENT_KEY === "ShiftLeft") &&
    CURRENT_LAYOUT.state === "caps"
  ) {
    changeLayout("shiftCaps");
  } else if (CURRENT_KEY === "ShiftRight" || CURRENT_KEY === "ShiftLeft") {
    changeLayout("caseUp");
  }
  if (CURRENT_KEY === "CapsLock") {
    if (CURR_TARGET.classList.contains("caps")) {
      changeLayout("caseDown");
      CURRENT_LAYOUT.capsOn = false;
    } else {
      changeLayout("caps");
      CURRENT_LAYOUT.capsOn = true;
    }
  }
  console.log(CTRL_KEY);
  if (
    (CURRENT_KEY === "AltLeft" && CTRL_KEY.classList.contains("active")) ||
    (CURRENT_KEY === "ControlLeft" && ALT_KEY.classList.contains("active"))
  ) {
    changeLanguage();
    changeLayout(CURRENT_LAYOUT.state);
  }
}

function onMouseUp(event) {
  event.preventDefault();
  const CURRENT_KEY = event.target.closest(".key").classList[1];
  hideCurrentClicked(event.target.closest(".key"));
  if (CURRENT_KEY === "ShiftRight" || CURRENT_KEY === "ShiftLeft") {
    if (CURRENT_LAYOUT.capsOn === false) {
      changeLayout("caseDown");
    } else {
      changeLayout("caps");
    }
  }
}

document.addEventListener("mousedown", (event) => onMouseDown(event));
document.addEventListener("mouseup", (event) => onMouseUp(event));

window.onload = () => {
  showKeyboard();
};
